<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi Espacio Terap√©utico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --beige:#f7f3ee;
  --lila:#c6b7e2;
  --menta:#bfe6d3;
  --menta-fuerte:#9fd9c1;
  --texto:#4a4a4a;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--beige);
  color:var(--texto);
}

header{
  padding:16px;
  background:linear-gradient(90deg,var(--menta),var(--lila));
}

.tabs{
  display:flex;
  gap:6px;
  padding:10px;
  background:#fff;
  overflow-x:auto;
}

.tab{
  border:none;
  background:var(--menta);
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
}

.tab.active{
  background:var(--menta-fuerte);
  font-weight:600;
}

.content{display:none;padding:16px;}
.content.active{display:block}

/* ---------- D√çA ---------- */

.day-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.date-nav button{
  border:none;
  background:none;
  font-size:20px;
  cursor:pointer;
}

.intention{
  margin:12px 0;
  font-style:italic;
  color:#9a8bc7;
}

.hour-block{
  background:#fff;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
  border-left:6px solid var(--menta);
}

.half-hour{
  display:flex;
  gap:6px;
  align-items:center;
  margin-top:6px;
}

.half-hour input[type="text"]{
  flex:1;
  border:1px solid #ddd;
  border-radius:8px;
  padding:6px;
}

/* ---------- SEMANA (solo lectura por ahora) ---------- */

.week-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}

.week-day{
  background:#fff;
  border-radius:12px;
  padding:8px;
  min-height:140px;
  border-top:6px solid var(--menta);
}

.week-day h4{
  margin:0 0 6px;
  font-size:13px;
}

.week-event{
  font-size:12px;
  background:#eef8f3;
  border-radius:6px;
  padding:4px;
  margin-bottom:4px;
}
</style>
</head>

<body>

<header>üå± Mi espacio</header>

<div class="tabs">
  <button class="tab active" onclick="openTab('day')">D√≠a</button>
  <button class="tab" onclick="openTab('week')">Semana</button>
</div>

<!-- D√çA -->
<div id="day" class="content active">
  <div class="day-header">
    <div class="date-nav">
      <button onclick="changeDay(-1)">‚Üê</button>
      <span id="currentDate"></span>
      <button onclick="changeDay(1)">‚Üí</button>
    </div>
  </div>

  <div class="intention">
    Intenci√≥n del d√≠a...
    <input id="intentionInput" type="text" style="width:100%" oninput="saveDayData()">
  </div>

  <div id="hours"></div>
</div>

<!-- SEMANA -->
<div id="week" class="content">
  <div class="week-grid" id="weekGrid"></div>
</div>

<script>
/* ========= CONFIG ========= */
const USE_FIREBASE = false; // ‚Üê cuando quieras activar Firebase
/* ========================== */

let currentDay = new Date();
let dayData = JSON.parse(localStorage.getItem("dayData")||"{}");
let weekEvents = JSON.parse(localStorage.getItem("weekEvents")||"{}");

/* ---------- UTIL ---------- */
function formatDate(d){
  return d.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"});
}
function dateKey(d){
  return d.toISOString().split("T")[0];
}

/* ---------- TABS ---------- */
function openTab(id){
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

/* ---------- D√çA ---------- */
function renderDay(){
  document.getElementById("currentDate").textContent = formatDate(currentDay);
  const key=dateKey(currentDay);
  if(!dayData[key]) dayData[key]={intention:"",hours:{}};
  document.getElementById("intentionInput").value = dayData[key].intention;
}

function changeDay(n){
  currentDay.setDate(currentDay.getDate()+n);
  renderDay();
  renderHours();
}

function renderHours(){
  const c=document.getElementById("hours");
  c.innerHTML="";
  const key=dateKey(currentDay);
  for(let h=4;h<=23;h++){
    const b=document.createElement("div");
    b.className="hour-block";
    b.innerHTML=`<strong>${h}:00</strong>`;
    ["00","30"].forEach(m=>{
      const time=`${h}:${m}`;
      if(!dayData[key].hours[time]){
        dayData[key].hours[time]={text:"",done:false,show:false};
      }
      const d=dayData[key].hours[time];
      const row=document.createElement("div");
      row.className="half-hour";
      row.innerHTML=`
        <input type="checkbox" ${d.done?"checked":""}
          onchange="toggleDone('${time}',this.checked)">
        <input type="text" value="${d.text}"
          oninput="updateText('${time}',this.value)">
        <label>
          <input type="checkbox" ${d.show?"checked":""}
            onchange="toggleWeek(this,'${time}')">
          mostrar en semana
        </label>`;
      b.appendChild(row);
    });
    c.appendChild(b);
  }
}

function saveDayData(){
  const key=dateKey(currentDay);
  dayData[key].intention = document.getElementById("intentionInput").value;
  localStorage.setItem("dayData",JSON.stringify(dayData));
}

function updateText(time,val){
  dayData[dateKey(currentDay)].hours[time].text=val;
  localStorage.setItem("dayData",JSON.stringify(dayData));
}

function toggleDone(time,val){
  dayData[dateKey(currentDay)].hours[time].done=val;
  localStorage.setItem("dayData",JSON.stringify(dayData));
}

/* ---------- SEMANA ---------- */
function startOfWeek(d){
  const n=new Date(d);
  const day=n.getDay()||7;
  n.setDate(n.getDate()-day+1);
  return n;
}

function renderWeek(){
  const grid=document.getElementById("weekGrid");
  grid.innerHTML="";
  let base=startOfWeek(new Date());

  for(let i=0;i<7;i++){
    const d=new Date(base);
    d.setDate(base.getDate()+i);
    const key=dateKey(d);

    const col=document.createElement("div");
    col.className="week-day";
    col.innerHTML=`<h4>${d.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"})}</h4>`;

    (weekEvents[key]||[]).forEach(e=>{
      col.innerHTML+=`<div class="week-event">üïí ${e.time} ‚Äì ${e.text}</div>`;
    });

    grid.appendChild(col);
  }
}

/* ---------- CONEXI√ìN D√çA ‚Üí SEMANA ---------- */
function toggleWeek(cb,time){
  const text=dayData[dateKey(currentDay)].hours[time].text;
  const key=dateKey(currentDay);
  dayData[key].hours[time].show=cb.checked;

  if(!weekEvents[key]) weekEvents[key]=[];

  if(cb.checked){
    weekEvents[key].push({time,text});
  }else{
    weekEvents[key]=weekEvents[key].filter(e=>e.time!==time||e.text!==text);
  }

  localStorage.setItem("dayData",JSON.stringify(dayData));
  localStorage.setItem("weekEvents",JSON.stringify(weekEvents));
  renderWeek();
}

/* ---------- INIT ---------- */
renderDay();
renderHours();
renderWeek();
</script>

</body>
</html>

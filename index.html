<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mi Espacio Personal</title>

<style>
:root{
  --beige:#f7f5f2;
  --lila:#cbbce6;
  --menta:#9fd6c2;
  --menta-soft:#e6f4ef;
  --texto:#3a3a3a;
}

body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--beige);
  color:var(--texto);
}

header{
  padding:16px;
  background:linear-gradient(90deg,var(--menta),var(--lila));
  color:white;
  text-align:center;
}

nav{
  display:flex;
  justify-content:space-around;
  background:white;
  padding:10px;
  border-radius:16px;
  margin:12px;
}

nav button{
  background:none;
  border:none;
  color:#666;
}

nav button.active{ color:var(--lila); }

section{ display:none; padding:16px; max-width:1200px; margin:auto; }
section.active{ display:block; }

.card{
  background:white;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

/* FECHA */
.date-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--menta-soft);
  padding:12px;
  border-radius:12px;
  margin-bottom:16px;
}

.date-bar button{
  background:var(--menta);
  border:none;
  color:white;
  padding:6px 12px;
  border-radius:8px;
}

/* INTENCI√ìN */
.intention textarea{
  font-style:italic;
  color:var(--lila);
  border:none;
  resize:none;
  outline:none;
  width:100%;
}

/* HORAS */
.hour-block{
  background:white;
  border-radius:14px;
  padding:12px;
  margin-bottom:16px;
  border-left:6px solid var(--menta);
}

.sub-block{
  background:var(--menta-soft);
  border-radius:10px;
  padding:8px;
  margin-top:6px;
}

.sub-header{
  display:flex;
  justify-content:space-between;
  font-size:0.75rem;
}

/* SEMANA */
.week-nav{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
}

.week-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}

.week-day{
  background:white;
  border-radius:12px;
  padding:8px;
  min-height:120px;
}

.week-day strong{
  display:block;
  margin-bottom:6px;
  color:var(--lila);
  font-size:0.85rem;
}

.week-item{
  background:var(--menta-soft);
  border-radius:8px;
  padding:6px;
  font-size:0.75rem;
  margin-bottom:6px;
}

/* STICKIES */
.sticky{
  position:absolute;
  background:#fff8b5;
  padding:12px;
  border-radius:12px;
  width:160px;
  cursor:move;
}
</style>
</head>

<body>

<header>üåø Mi espacio terap√©utico</header>

<nav>
  <button class="active" onclick="openTab('dia')">D√≠a</button>
  <button onclick="openTab('semana')">Semana</button>
</nav>

<section id="dia" class="active">
  <div class="date-bar">
    <button onclick="changeDay(-1)">‚óÄ</button>
    <div id="dateText"></div>
    <button onclick="changeDay(1)">‚ñ∂</button>
  </div>

  <div class="card intention">
    <textarea id="intention" rows="2" placeholder="Intenci√≥n del d√≠a..."></textarea>
  </div>

  <div id="schedule"></div>
</section>

<section id="semana">
  <div class="week-nav">
    <button onclick="changeWeek(-7)">‚¨Ü Semana anterior</button>
    <button onclick="changeWeek(7)">‚¨á Semana siguiente</button>
  </div>
  <div class="week-grid" id="weekGrid"></div>
</section>

<button onclick="newSticky()" style="position:fixed;bottom:20px;right:20px;">‚ûï Nota</button>

<script>
function openTab(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
}

let currentDate=new Date();
let weekOffset=0;

function formatDate(d){
  return d.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long'});
}

function changeDay(o){ currentDate.setDate(currentDate.getDate()+o); loadDay(); loadWeek(); }

function loadDay(){
  const key=currentDate.toISOString().split('T')[0];
  document.getElementById('dateText').innerText=formatDate(currentDate);

  const intent=document.getElementById('intention');
  intent.value=localStorage.getItem(key+'-intent')||'';
  intent.oninput=()=>localStorage.setItem(key+'-intent',intent.value);

  const sch=document.getElementById('schedule');
  sch.innerHTML='';

  for(let h=4;h<=23;h++){
    const block=document.createElement('div');
    block.className='hour-block';
    block.innerHTML=`<strong>${h}:00</strong>`;

    ['00','30'].forEach(m=>{
      const id=`${key}-${h}-${m}`;
      const fix=id+'-fix';

      const s=document.createElement('div');
      s.className='sub-block';
      s.innerHTML=`
        <div class="sub-header">
          ${h}:${m}
          <label><input type="checkbox" id="${fix}"> ‚≠ê</label>
        </div>
        <textarea rows="2" id="${id}"></textarea>
      `;

      const ta=s.querySelector(`#${id}`);
      ta.value=localStorage.getItem(id)||'';
      ta.oninput=()=>localStorage.setItem(id,ta.value);

      const f=s.querySelector(`#${fix}`);
      f.checked=localStorage.getItem(fix)==='1';
      f.onchange=()=>{localStorage.setItem(fix,f.checked?'1':'0');loadWeek();};

      block.appendChild(s);
    });

    sch.appendChild(block);
  }
}

function getMonday(d){
  const date=new Date(d);
  const day=date.getDay()||7;
  date.setDate(date.getDate()-day+1);
  return date;
}

function changeWeek(d){ weekOffset+=d; loadWeek(); }

function loadWeek(){
  const grid=document.getElementById('weekGrid');
  grid.innerHTML='';

  const base=new Date();
  base.setDate(base.getDate()+weekOffset);
  const monday=getMonday(base);

  for(let i=0;i<7;i++){
    const day=new Date(monday);
    day.setDate(monday.getDate()+i);
    const key=day.toISOString().split('T')[0];

    const col=document.createElement('div');
    col.className='week-day';
    col.innerHTML=`<strong>${formatDate(day)}</strong>`;

    Object.keys(localStorage).forEach(k=>{
      if(k.startsWith(key) && k.endsWith('-fix') && localStorage.getItem(k)==='1'){
        const baseKey=k.replace('-fix','');
        const txt=localStorage.getItem(baseKey);
        if(txt){
          col.innerHTML+=`<div class="week-item">${txt}</div>`;
        }
      }
    });

    grid.appendChild(col);
  }
}

function newSticky(){
  const n=document.createElement('div');
  n.className='sticky';
  n.contentEditable=true;
  n.innerText='nota‚Ä¶';
  n.style.top='120px';
  n.style.left='120px';
  document.body.appendChild(n);
  n.onmousedown=e=>{
    const x=e.offsetX,y=e.offsetY;
    document.onmousemove=ev=>{
      n.style.left=(ev.pageX-x)+'px';
      n.style.top=(ev.pageY-y)+'px';
    };
    document.onmouseup=()=>document.onmousemove=null;
  }
}

loadDay(); loadWeek();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi Espacio Terap√©utico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --beige:#f7f3ee;
  --lila:#c6b7e2;
  --menta:#bfe6d3;
  --menta-fuerte:#9fd9c1;
  --salmon:#f4b6a8;
  --azul:#b7d8f4;
  --ocre:#f1d18a;
  --texto:#4a4a4a;
}

/* ================== BASE ================== */
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--beige);
  color:var(--texto);
}

header{
  padding:16px;
  background:linear-gradient(90deg,var(--menta),var(--lila));
  font-weight:600;
}

.tabs{
  display:flex;
  gap:6px;
  padding:10px;
  background:#fff;
  overflow-x:auto;
}

.tab{
  border:none;
  background:var(--menta);
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}

.tab.active{
  background:var(--menta-fuerte);
  font-weight:600;
}

.content{
  display:none;
  padding:16px;
}

.content.active{
  display:block;
}

/* ================== D√çA ================== */
.day-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.date-nav button{
  border:none;
  background:none;
  font-size:20px;
  cursor:pointer;
}

.intention{
  margin:12px 0;
  font-style:italic;
  color:#9a8bc7;
}

.hour-block{
  background:#fff;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
  border-left:6px solid var(--menta);
}

.half-hour{
  display:flex;
  gap:6px;
  align-items:center;
  margin-top:6px;
}

.half-hour input[type="text"]{
  flex:1;
  border:1px solid #ddd;
  border-radius:8px;
  padding:6px;
}

/* ================== SEMANA ================== */
.week-nav{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-bottom:10px;
}

.week-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}

.week-day{
  background:#fff;
  border-radius:12px;
  padding:8px;
  min-height:160px;
  border-top:6px solid var(--menta);
}

.week-day h4{
  margin:0 0 6px;
  font-size:13px;
}

.week-event{
  font-size:12px;
  background:#eef8f3;
  border-radius:6px;
  padding:4px;
  margin-bottom:4px;
  display:flex;
  justify-content:space-between;
  gap:6px;
}

.week-event button{
  border:none;
  background:none;
  cursor:pointer;
}

/* ================== MES ================== */
.month-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}

.month-day{
  background:#fff;
  border-radius:10px;
  padding:6px;
  min-height:90px;
  border-top:4px solid var(--menta);
  font-size:12px;
}

.month-event{
  margin-top:4px;
  border-radius:6px;
  padding:2px 4px;
  font-size:11px;
  display:flex;
  justify-content:space-between;
}

.month-cumple{background:var(--salmon);}
.month-vet{background:var(--menta);}
.month-medico{background:var(--azul);}

/* ================== SEMESTRE ================== */
.semester{
  display:grid;
  grid-template-columns:1fr;
  gap:20px;
}

.semester-month{
  background:#fff;
  border-radius:16px;
  padding:10px;
}

.semester-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  font-size:11px;
}

.semester-day{
  border-radius:6px;
  padding:4px;
  background:#f5f5f5;
  display:flex;
  flex-direction:column;
  gap:2px;
}

.roadbar{
  width:100%;
  height:6px;
  border-radius:4px;
  opacity:.85;
  cursor:pointer;
}

/* ================== PROYECTOS ================== */
.projects-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.add-project-btn{
  border:none;
  background:var(--menta);
  width:36px;
  height:36px;
  border-radius:50%;
  font-size:20px;
  cursor:pointer;
}

.projects-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
  gap:12px;
}

.project-folder{
  background:#fff;
  border-radius:12px;
  padding:12px;
  text-align:center;
  cursor:pointer;
}

.project-folder .icon{
  font-size:32px;
}

/* colores carpetas */
.folder-rosado{background:#f7c6d9;}
.folder-salmon{background:var(--salmon);}
.folder-lila{background:var(--lila);}
.folder-violeta{background:#b49ddb;}
.folder-menta{background:var(--menta);}
.folder-aguamarina{background:#a8e6e1;}
.folder-azul{background:var(--azul);}
.folder-ocre{background:var(--ocre);}
.folder-beige{background:var(--beige);}

/* subvista proyecto */
.project-view{display:none;}
.project-view.active{display:block;}

.project-view-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  border-radius:12px;
  margin-bottom:12px;
}

.close-project{
  border:none;
  background:none;
  font-size:18px;
  cursor:pointer;
}

.project-section{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}

/* ================== MODALES ================== */
#monthModal,
#semesterModal,
#projectModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.3);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.modal-box{
  background:#fff;
  padding:16px;
  border-radius:12px;
  width:260px;
}

/* ================== BURBUJA ================== */
#semesterInfo{
  position:fixed;
  background:#fff;
  border:1px solid #ccc;
  padding:10px;
  border-radius:10px;
  display:none;
  z-index:9999;
}
</style>
</head>
<body>

<header>üå± Mi espacio</header>

<div class="tabs">
  <button class="tab active" onclick="openTab('day')">D√≠a</button>
  <button class="tab" onclick="openTab('week')">Semana</button>
  <button class="tab" onclick="openTab('month')">Mes</button>
  <button class="tab" onclick="openTab('semester')">Semestre</button>
  <button class="tab" onclick="openTab('projects')">Proyectos</button>
  <button class="tab" onclick="openTab('health')">Salud</button>
</div>

<!-- ================== D√çA ================== -->
<div id="day" class="content active">
  <div class="day-header">
    <div class="date-nav">
      <button onclick="changeDay(-1)">‚Üê</button>
      <span id="currentDate"></span>
      <button onclick="changeDay(1)">‚Üí</button>
    </div>
  </div>

  <div class="intention">
    Intenci√≥n del d√≠a
    <input type="text" id="dayIntention" style="width:100%;margin-top:6px">
  </div>

  <div id="hours"></div>
</div>

<!-- ================== SEMANA ================== -->
<div id="week" class="content">
  <div class="week-nav">
    <button onclick="changeWeek(-1)">‚Üë</button>
    <strong>Semana</strong>
    <button onclick="changeWeek(1)">‚Üì</button>
  </div>
  <div class="week-grid" id="weekGrid"></div>
</div>

<!-- ================== MES ================== -->
<div id="month" class="content">
  <div id="monthGrid" class="month-grid"></div>
</div>

<!-- ================== MODAL MES ================== -->
<div id="monthModal">
  <div class="modal-box">
    <h4>Nuevo evento</h4>

    <label>Categor√≠a</label>
    <select id="monthCategory" onchange="handleMonthCategory()">
      <option value="">Selecciona</option>
      <option value="cumple">Cumplea√±os</option>
      <option value="vet">Vet</option>
      <option value="medico">M√©dico</option>
    </select>

    <input id="monthDetail" type="text" placeholder="Detalle">
    <input id="monthHour" type="time" style="display:none;">

    <button onclick="saveMonthEvent()">Guardar</button>
    <button onclick="closeMonthModal()">Cancelar</button>
  </div>
</div>

<!-- ================== SEMESTRE ================== -->
<div id="semester" class="content">
  <div id="semesterView" class="semester"></div>

  <div id="semesterInfo">
    <div id="semesterInfoContent"></div>
    <button onclick="editSemesterEvent()">‚úèÔ∏è Editar</button>
    <button onclick="deleteSemesterEvent()">üóë Eliminar</button>
  </div>
</div>

<!-- ================== MODAL SEMESTRE ================== -->
<div id="semesterModal">
  <div class="modal-box">
    <h4>Nuevo proyecto</h4>

    <label><input type="checkbox" value="DesdeCeroLatam"> DesdeCeroLatam</label><br>
    <label><input type="checkbox" value="RelazoApp"> RelazoApp</label><br>
    <label><input type="checkbox" value="ComoSucedio"> ComoSucedio</label><br>
    <label><input type="checkbox" value="SegundoLibro"> SegundoLibro</label><br>
    <label><input type="checkbox" value="VidaEnEuropa"> VidaEnEuropa</label><br><br>

    <input id="semStart" type="date"><br><br>
    <input id="semEnd" type="date"><br><br>
    <input id="semDetail" type="text" placeholder="Detalle"><br><br>

    <button onclick="saveSemesterEvent()">Guardar</button>
    <button onclick="closeSemesterModal()">Cancelar</button>
  </div>
</div>

<!-- ================== PROYECTOS ================== -->
<div id="projects" class="content">

  <!-- Vista principal -->
  <div id="projectsMain">
    <div class="projects-header">
      <h3>üìÅ Proyectos</h3>
      <button class="add-project-btn" onclick="openProjectModal()">Ôºã</button>
    </div>

    <div class="projects-grid" id="projectsGrid"></div>
  </div>

  <!-- Subvista proyecto -->
  <div id="projectView" class="project-view">
    <div class="project-view-header" id="projectViewHeader">
      <strong id="projectTitle"></strong>
      <button class="close-project" onclick="closeProjectView()">‚úñ</button>
    </div>

    <div class="project-section">
      <h4>‚úÖ Pendientes</h4>
      <div id="projectTasks"></div>
      <button onclick="addProjectTask()">Ôºã</button>
    </div>

    <div class="project-section">
      <h4>üìÇ Documentos importantes</h4>
      <p style="font-size:12px;color:#777">
        Pr√≥ximamente podr√°s subir archivos (pdf, doc, jpg, etc.)
      </p>
    </div>

    <div class="project-section">
      <h4>üé® Kit de marca</h4>
      <ul style="font-size:12px;color:#777">
        <li>Colores de marca</li>
        <li>Tipograf√≠as</li>
        <li>Logo</li>
        <li>Im√°genes</li>
        <li>Banco de temas</li>
      </ul>
    </div>
  </div>

</div>

<!-- ================== MODAL NUEVO PROYECTO ================== -->
<div id="projectModal">
  <div class="modal-box">
    <h4>Nuevo proyecto</h4>

    <input id="projectName" type="text" placeholder="Nombre del proyecto">

    <label>Color</label>
    <select id="projectColor">
      <option value="rosado">Rosado</option>
      <option value="salmon">Salm√≥n</option>
      <option value="lila">Lila</option>
      <option value="violeta">Violeta</option>
      <option value="menta">Menta</option>
      <option value="aguamarina">Aguamarina</option>
      <option value="azul">Azul</option>
      <option value="ocre">Ocre</option>
      <option value="beige">Beige</option>
    </select>

    <button onclick="saveProject()">Crear</button>
    <button onclick="closeProjectModal()">Cancelar</button>
  </div>
</div>

<!-- ================== SALUD ================== -->
<div id="health" class="content">üíö Salud (en desarrollo)</div>
<script>
/* ================== ESTADO GLOBAL ================== */
let currentDay = new Date();
let currentWeekOffset = 0;
let currentMonth = new Date();
let semesterStart = new Date(currentMonth.getFullYear(), 0, 1);

let events = JSON.parse(localStorage.getItem("events") || "[]");
let projects = JSON.parse(localStorage.getItem("projects") || "[]");

let selectedSemesterEvent = null;
let selectedMonthDate = null;
let activeProject = null;

/* ================== UTILIDADES ================== */
function saveEvents(){
  localStorage.setItem("events", JSON.stringify(events));
}

function saveProjects(){
  localStorage.setItem("projects", JSON.stringify(projects));
}

function formatDate(d){
  return d.toISOString().split("T")[0];
}

function openTab(id){
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

/* ================== D√çA ================== */
function renderDay(){
  document.getElementById("currentDate").textContent =
    currentDay.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"});

  const container = document.getElementById("hours");
  container.innerHTML="";

  for(let h=6;h<=22;h++){
    const block=document.createElement("div");
    block.className="hour-block";
    block.innerHTML=`
      <strong>${h}:00</strong>
      <label style="float:right">
        <input type="checkbox">
        Mostrar en semana
      </label>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":00">
      </div>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":30">
      </div>
    `;
    container.appendChild(block);
  }
}

function changeDay(delta){
  currentDay.setDate(currentDay.getDate()+delta);
  renderDay();
}

/* ================== SEMANA ================== */
function renderWeek(){
  const grid=document.getElementById("weekGrid");
  grid.innerHTML="";
  const base=new Date();
  base.setDate(base.getDate()-base.getDay()+1+(currentWeekOffset*7));

  for(let i=0;i<7;i++){
    const d=new Date(base);
    d.setDate(base.getDate()+i);
    const dayDiv=document.createElement("div");
    dayDiv.className="week-day";
    dayDiv.innerHTML=`<h4>${d.toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})}</h4>`;

    events
      .filter(e=>e.date===formatDate(d) && e.showWeek)
      .forEach((e,idx)=>{
        const ev=document.createElement("div");
        ev.className="week-event";
        ev.innerHTML=`
          ${e.text||""} ${e.hour||""}
          <button onclick="deleteEvent(${idx})">üóë</button>
        `;
        dayDiv.appendChild(ev);
      });

    grid.appendChild(dayDiv);
  }
}

function changeWeek(delta){
  currentWeekOffset+=delta;
  renderWeek();
}

/* ================== MES ================== */
function renderMonth(){
  const grid=document.getElementById("monthGrid");
  grid.innerHTML="";
  const y=currentMonth.getFullYear();
  const m=currentMonth.getMonth();
  const first=new Date(y,m,1);
  const start=(first.getDay()+6)%7;
  const days=new Date(y,m+1,0).getDate();

  for(let i=0;i<start;i++) grid.appendChild(document.createElement("div"));

  for(let d=1;d<=days;d++){
    const date=new Date(y,m,d);
    const cell=document.createElement("div");
    cell.className="month-day";
    cell.innerHTML=`<strong>${d}</strong>`;
    cell.onclick=()=>openMonthModal(date);

    events.filter(e=>e.date===formatDate(date)).forEach((e,idx)=>{
      const ev=document.createElement("div");
      ev.className="month-event "+(e.class||"");
      ev.innerHTML=`
        ${e.text||""}${e.hour?" ‚è∞"+e.hour:""}
        <span onclick="deleteEvent(${idx})">üóë</span>
      `;
      cell.appendChild(ev);
    });

    grid.appendChild(cell);
  }
}

/* ================== MODAL MES ================== */
function openMonthModal(date){
  selectedMonthDate=date;
  monthCategory.value="";
  monthDetail.value="";
  monthHour.value="";
  monthHour.style.display="none";
  document.getElementById("monthModal").style.display="flex";
}

function closeMonthModal(){
  document.getElementById("monthModal").style.display="none";
}

function handleMonthCategory(){
  const cat=monthCategory.value;
  monthHour.style.display=(cat==="vet"||cat==="medico")?"block":"none";
}

function saveMonthEvent(){
  const cat=monthCategory.value;
  const detail=monthDetail.value;
  const hour=monthHour.value;

  if(!cat||!detail) return alert("Completa los campos");

  let text="", cls="";
  if(cat==="cumple"){text="üéÇ "+detail;cls="month-cumple";}
  if(cat==="vet"){text="üê∂ Vet: "+detail;cls="month-vet";}
  if(cat==="medico"){text="ü©∫ M√©dico: "+detail;cls="month-medico";}

  events.push({
    date:formatDate(selectedMonthDate),
    text,
    hour,
    class:cls
  });

  saveEvents();
  closeMonthModal();
  renderMonth();
  renderWeek();
}

/* ================== SEMESTRE ================== */
function renderSemester(){
  const cont=document.getElementById("semesterView");
  cont.innerHTML="";

  for(let m=0;m<6;m++){
    const month=new Date(semesterStart.getFullYear(),semesterStart.getMonth()+m,1);
    const box=document.createElement("div");
    box.className="semester-month";
    box.innerHTML=`<h4>${month.toLocaleDateString("es-ES",{month:"long"})}</h4>`;

    const grid=document.createElement("div");
    grid.className="semester-grid";

    const days=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();
    for(let d=1;d<=days;d++){
      const cell=document.createElement("div");
      cell.className="semester-day";
      cell.textContent=d;

      events.filter(e=>e.start&&e.end &&
        new Date(e.start)<=new Date(month.getFullYear(),month.getMonth(),d) &&
        new Date(e.end)>=new Date(month.getFullYear(),month.getMonth(),d)
      ).forEach(e=>{
        const bar=document.createElement("div");
        bar.className="roadbar "+e.class;
        bar.onclick=(evt)=>showSemesterInfo(e,evt);
        cell.appendChild(bar);
      });

      cell.onclick=()=>openSemesterModal();
      grid.appendChild(cell);
    }

    box.appendChild(grid);
    cont.appendChild(box);
  }
}

/* ================== PROYECTOS ================== */
function openProjectModal(){
  projectName.value="";
  projectColor.value="rosado";
  projectModal.style.display="flex";
}

function closeProjectModal(){
  projectModal.style.display="none";
}

function saveProject(){
  const name=projectName.value.trim();
  const color=projectColor.value;
  if(!name) return alert("Ponle nombre");

  projects.push({
    id:Date.now(),
    name,
    color,
    tasks:[],
    documents:[],
    brandKit:{}
  });

  saveProjects();
  closeProjectModal();
  renderProjects();
}

function renderProjects(){
  const grid=document.getElementById("projectsGrid");
  grid.innerHTML="";

  projects.forEach(p=>{
    const div=document.createElement("div");
    div.className=`project-folder folder-${p.color}`;
    div.innerHTML=`
      <div class="icon">üìÅ</div>
      <div>${p.name}</div>
    `;
    div.onclick=()=>openProject(p.id);
    grid.appendChild(div);
  });
}

function openProject(id){
  activeProject=projects.find(p=>p.id===id);
  projectsMain.style.display="none";
  projectView.classList.add("active");
  projectTitle.textContent=activeProject.name;
  projectViewHeader.className=`project-view-header folder-${activeProject.color}`;
  renderProjectTasks();
}

function closeProjectView(){
  projectView.classList.remove("active");
  projectsMain.style.display="block";
  activeProject=null;
}

function renderProjectTasks(){
  projectTasks.innerHTML="";
  activeProject.tasks.forEach((t,idx)=>{
    const row=document.createElement("div");
    row.innerHTML=`
      <input type="checkbox" ${t.done?"checked":""}
        onchange="toggleTask(${idx})">
      ${t.text}
    `;
    projectTasks.appendChild(row);
  });
}

function addProjectTask(){
  const text=prompt("Pendiente");
  if(!text) return;
  activeProject.tasks.push({text,done:false});
  saveProjects();
  renderProjectTasks();
}

function toggleTask(idx){
  activeProject.tasks[idx].done=!activeProject.tasks[idx].done;
  saveProjects();
}

/* ================== SEMESTRE MODAL ================== */
function openSemesterModal(){
  semesterModal.style.display="flex";
}

function closeSemesterModal(){
  semesterModal.style.display="none";
}

function saveSemesterEvent(){
  const cats=[...semesterModal.querySelectorAll("input:checked")].map(c=>c.value);
  if(!cats.length) return;

  const start=semStart.value;
  const end=semEnd.value;
  const detail=semDetail.value;

  cats.forEach(cat=>{
    events.push({start,end,detail,class:"cat-"+cat});
  });

  saveEvents();
  closeSemesterModal();
  renderSemester();
}

/* ================== BORRAR ================== */
function deleteEvent(idx){
  if(confirm("Eliminar evento?")){
    events.splice(idx,1);
    saveEvents();
    renderWeek();
    renderMonth();
    renderSemester();
  }
}

/* ================== INIT ================== */
renderDay();
renderWeek();
renderMonth();
renderSemester();
renderProjects();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi Espacio Terap√©utico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --beige:#f7f3ee;
  --lila:#c6b7e2;
  --menta:#bfe6d3;
  --menta-fuerte:#9fd9c1;
  --salmon:#f4b6a8;
  --azul:#b7d8f4;
  --ocre:#f1d18a;
  --texto:#4a4a4a;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--beige);
  color:var(--texto);
}

header{
  padding:16px;
  background:linear-gradient(90deg,var(--menta),var(--lila));
  font-weight:600;
}

.tabs{
  display:flex;
  gap:6px;
  padding:10px;
  background:#fff;
  overflow-x:auto;
}

.tab{
  border:none;
  background:var(--menta);
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}

.tab.active{
  background:var(--menta-fuerte);
  font-weight:600;
}

.content{
  display:none;
  padding:16px;
}

.content.active{
  display:block;
}

/* ================== D√çA ================== */
.day-header{display:flex;justify-content:space-between;align-items:center;}
.date-nav button{border:none;background:none;font-size:20px;cursor:pointer;}
.intention{margin:12px 0;font-style:italic;color:#9a8bc7;}
.hour-block{
  background:#fff;border-radius:12px;padding:10px;margin-bottom:10px;
  border-left:6px solid var(--menta);
}
.half-hour{display:flex;gap:6px;align-items:center;margin-top:6px;}
.half-hour input[type="text"]{
  flex:1;border:1px solid #ddd;border-radius:8px;padding:6px;
}

/* ================== SEMANA ================== */
.week-nav{display:flex;justify-content:center;gap:20px;margin-bottom:10px;}
.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
.week-day{
  background:#fff;border-radius:12px;padding:8px;
  min-height:160px;border-top:6px solid var(--menta);
}
.week-day h4{margin:0 0 6px;font-size:13px;}
.week-event{
  font-size:12px;background:#eef8f3;border-radius:6px;
  padding:4px;margin-bottom:4px;
  display:flex;justify-content:space-between;gap:6px;
}
.week-event button{border:none;background:none;cursor:pointer;}

/* ================== MES ================== */
.month-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;}
.month-day{
  background:#fff;border-radius:10px;padding:6px;
  min-height:90px;border-top:4px solid var(--menta);
  font-size:12px;
}
.month-event{
  margin-top:4px;border-radius:6px;
  padding:2px 4px;font-size:11px;
  display:flex;justify-content:space-between;
}

/* ================== SEMESTRE ================== */
.semester{display:grid;grid-template-columns:1fr;gap:20px;}
.semester-month{background:#fff;border-radius:16px;padding:10px;}
.semester-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;font-size:11px;}

/* üî• CLAVE PARA BARRAS M√öLTIPLES */
.semester-day{
  border-radius:6px;
  padding:4px;
  background:#f5f5f5;
  display:flex;
  flex-direction:column;
  gap:2px;
}

/* ================== BARRAS ROADMAP ================== */
.roadbar{
  width:100%;
  height:6px;
  border-radius:4px;
  opacity:.85;
  cursor:pointer;
}

/* ================== COLORES ================== */
.cat-DesdeCeroLatam{background:var(--menta);}
.cat-RelazoApp{background:var(--lila);}
.cat-ComoSucedio{background:var(--salmon);}
.cat-SegundoLibro{background:var(--azul);}
.cat-VidaEnEuropa{background:var(--ocre);}

/* ================== BURBUJA ================== */
#semesterInfo{
  position:fixed;
  background:#fff;
  border:1px solid #ccc;
  padding:10px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  display:none;
  max-width:300px;
  font-size:14px;
  z-index:9999;
}

#semesterInfo button{
  margin-top:6px;
  margin-right:6px;
  font-size:12px;
}

/* ================== MODAL ================== */
#semesterModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.3);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.modal-box{
  background:#fff;
  padding:16px;
  border-radius:12px;
  width:260px;
  font-size:14px;
}
</style>
</head>
<body>

<header>üå± Mi espacio</header>

<div class="tabs">
  <button class="tab active" onclick="openTab('day')">D√≠a</button>
  <button class="tab" onclick="openTab('week')">Semana</button>
  <button class="tab" onclick="openTab('month')">Mes</button>
  <button class="tab" onclick="openTab('semester')">Semestre</button>
  <button class="tab" onclick="openTab('projects')">Proyectos</button>
  <button class="tab" onclick="openTab('health')">Salud</button>
</div>

<!-- ================== D√çA ================== -->
<div id="day" class="content active">
  <div class="day-header">
    <div class="date-nav">
      <button onclick="changeDay(-1)">‚Üê</button>
      <span id="currentDate"></span>
      <button onclick="changeDay(1)">‚Üí</button>
    </div>
  </div>

  <div class="intention">
    Intenci√≥n del d√≠a
    <input type="text" id="dayIntention" style="width:100%;margin-top:6px">
  </div>

  <div id="hours"></div>
</div>

<!-- ================== SEMANA ================== -->
<div id="week" class="content">
  <div class="week-nav">
    <button onclick="changeWeek(-1)">‚Üë</button>
    <strong>Semana</strong>
    <button onclick="changeWeek(1)">‚Üì</button>
  </div>
  <div class="week-grid" id="weekGrid"></div>
</div>

<!-- ================== MES ================== -->
<div id="month" class="content">
  <div id="monthGrid" class="month-grid"></div>
</div>

<!-- ================== SEMESTRE ================== -->
<div id="semester" class="content">
  <div id="semesterView" class="semester"></div>

  <!-- üîπ Burbuja de informaci√≥n -->
  <div id="semesterInfo">
    <div id="semesterInfoContent"></div>
    <button onclick="editSemesterEvent()">‚úèÔ∏è Editar</button>
    <button onclick="deleteSemesterEvent()">üóë Eliminar</button>
  </div>
</div>

<!-- ================== OTRAS ================== -->
<div id="projects" class="content">üéØ Proyectos (en desarrollo)</div>
<div id="health" class="content">üíö Salud (en desarrollo)</div>

<!-- ================== MODAL SEMESTRE ================== -->
<div id="semesterModal">
  <div class="modal-box">
    <h4 id="semesterModalTitle">Nuevo proyecto</h4>

    <label><input type="checkbox" value="DesdeCeroLatam"> DesdeCeroLatam</label><br>
    <label><input type="checkbox" value="RelazoApp"> RelazoApp</label><br>
    <label><input type="checkbox" value="ComoSucedio"> ComoSucedio</label><br>
    <label><input type="checkbox" value="SegundoLibro"> SegundoLibro</label><br>
    <label><input type="checkbox" value="VidaEnEuropa"> VidaEnEuropa</label><br><br>

    <input id="semStart" type="date"><br><br>
    <input id="semEnd" type="date"><br><br>
    <input id="semDetail" type="text" placeholder="Detalle"><br><br>

    <button onclick="saveSemesterEvent()">Guardar</button>
    <button onclick="closeSemesterModal()">Cancelar</button>
  </div>
</div>
<script>
/* ================== ESTADO GLOBAL ================== */
let currentDay = new Date();
let currentWeekOffset = 0;
let currentMonth = new Date();
let semesterStart = new Date(currentMonth.getFullYear(), 0, 1);

let events = JSON.parse(localStorage.getItem("events") || "[]");

/* üëâ referencia al evento seleccionado en semestre */
let selectedSemesterEvent = null;

/* ================== UTILIDADES ================== */
function saveEvents(){
  localStorage.setItem("events", JSON.stringify(events));
}

function formatDate(d){
  return d.toISOString().split("T")[0];
}

function openTab(id){
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

/* ================== D√çA ================== */
function renderDay(){
  document.getElementById("currentDate").textContent =
    currentDay.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"});

  const container = document.getElementById("hours");
  container.innerHTML="";

  for(let h=6;h<=22;h++){
    const block=document.createElement("div");
    block.className="hour-block";
    block.innerHTML=`
      <strong>${h}:00</strong>
      <label style="float:right">
        <input type="checkbox">
        Mostrar en semana
      </label>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":00">
      </div>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":30">
      </div>
    `;
    container.appendChild(block);
  }
}

function changeDay(delta){
  currentDay.setDate(currentDay.getDate()+delta);
  renderDay();
}

/* ================== SEMANA ================== */
function renderWeek(){
  const grid=document.getElementById("weekGrid");
  grid.innerHTML="";
  const base=new Date();
  base.setDate(base.getDate()-base.getDay()+1+(currentWeekOffset*7));

  for(let i=0;i<7;i++){
    const d=new Date(base);
    d.setDate(base.getDate()+i);
    const dayDiv=document.createElement("div");
    dayDiv.className="week-day";
    dayDiv.innerHTML=`<h4>${d.toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})}</h4>`;

    events
      .filter(e=>e.date===formatDate(d) && e.showWeek)
      .forEach((e,idx)=>{
        const ev=document.createElement("div");
        ev.className="week-event";
        ev.innerHTML=`
          ${e.text||""} ${e.hour||""}
          <button onclick="deleteEvent(${idx})">üóë</button>
        `;
        dayDiv.appendChild(ev);
      });

    grid.appendChild(dayDiv);
  }
}

function changeWeek(delta){
  currentWeekOffset+=delta;
  renderWeek();
}

/* ================== MES ================== */
function renderMonth(){
  const grid=document.getElementById("monthGrid");
  grid.innerHTML="";
  const y=currentMonth.getFullYear();
  const m=currentMonth.getMonth();
  const first=new Date(y,m,1);
  const start=(first.getDay()+6)%7;
  const days=new Date(y,m+1,0).getDate();

  for(let i=0;i<start;i++) grid.appendChild(document.createElement("div"));

  for(let d=1;d<=days;d++){
    const date=new Date(y,m,d);
    const cell=document.createElement("div");
    cell.className="month-day";
    cell.innerHTML=`<strong>${d}</strong>`;
    cell.onclick=()=>addMonthEvent(date);

    events.filter(e=>e.date===formatDate(date)).forEach((e,idx)=>{
      const ev=document.createElement("div");
      ev.className="month-event "+(e.class||"");
      ev.innerHTML=`
        ${e.text||""}${e.hour?" ‚è∞"+e.hour:""}
        <span onclick="deleteEvent(${idx})">üóë</span>
      `;
      cell.appendChild(ev);
    });

    grid.appendChild(cell);
  }
}

function addMonthEvent(date){
  const type=prompt("Tipo: cumple / medico / vet");
  if(!type) return;

  let cls="", text="", hour="";
  if(type==="cumple"){
    text=prompt("Nombre");
  }
  if(type==="medico"){
    text="‚ö† Cita m√©dica";
    hour=prompt("Hora?");
  }
  if(type==="vet"){
    text="‚ö† Vet";
    hour=prompt("Hora?");
    cls="cat-DesdeCeroLatam";
  }

  events.push({date:formatDate(date),text,hour,class:cls});
  saveEvents();
  renderMonth();
  renderWeek();
}

/* ================== SEMESTRE ================== */
function renderSemester(){
  const cont=document.getElementById("semesterView");
  cont.innerHTML="";

  for(let m=0;m<6;m++){
    const month=new Date(semesterStart.getFullYear(),semesterStart.getMonth()+m,1);
    const box=document.createElement("div");
    box.className="semester-month";
    box.innerHTML=`<h4>${month.toLocaleDateString("es-ES",{month:"long"})}</h4>`;

    const grid=document.createElement("div");
    grid.className="semester-grid";

    const days=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();
    for(let d=1;d<=days;d++){
      const cell=document.createElement("div");
      cell.className="semester-day";
      cell.textContent=d;

      events
        .filter(e=>e.start && e.end &&
          new Date(e.start)<=new Date(month.getFullYear(),month.getMonth(),d) &&
          new Date(e.end)>=new Date(month.getFullYear(),month.getMonth(),d))
        .forEach(e=>{
          const bar=document.createElement("div");
          bar.className="roadbar "+e.class;
          bar.onclick=(evt)=>showSemesterInfo(e,evt);
          cell.appendChild(bar);
        });

      cell.onclick=()=>openSemesterModal();
      grid.appendChild(cell);
    }

    box.appendChild(grid);
    cont.appendChild(box);
  }
}

/* ================== BURBUJA SEMESTRE ================== */
function showSemesterInfo(e,evt){
  evt.stopPropagation();
  selectedSemesterEvent = e;

  const info=document.getElementById("semesterInfo");
  document.getElementById("semesterInfoContent").innerHTML=`
    <strong>Categor√≠a:</strong> ${e.class.replace("cat-","")}<br>
    <strong>Detalle:</strong> ${e.detail||"-"}<br>
    <strong>Inicio:</strong> ${e.start}<br>
    <strong>Fin:</strong> ${e.end}
  `;

  info.style.left=(evt.clientX+12)+"px";
  info.style.top=(evt.clientY+12)+"px";
  info.style.display="block";
}

document.addEventListener("click",()=>{
  document.getElementById("semesterInfo").style.display="none";
});

/* ================== EDITAR / ELIMINAR ================== */
function deleteSemesterEvent(){
  if(!selectedSemesterEvent) return;
  if(!confirm("¬øEliminar este evento?")) return;

  events = events.filter(e=>e!==selectedSemesterEvent);
  saveEvents();
  renderSemester();
  document.getElementById("semesterInfo").style.display="none";
}

function editSemesterEvent(){
  if(!selectedSemesterEvent) return;

  openSemesterModal();

  semStart.value = selectedSemesterEvent.start;
  semEnd.value = selectedSemesterEvent.end;
  semDetail.value = selectedSemesterEvent.detail||"";

  document
    .querySelectorAll('#semesterModal input[type="checkbox"]')
    .forEach(c=>{
      c.checked = ("cat-"+c.value) === selectedSemesterEvent.class;
    });

  events = events.filter(e=>e!==selectedSemesterEvent);
}

/* ================== MODAL ================== */
function openSemesterModal(){
  document.getElementById("semesterModal").style.display="flex";
}

function closeSemesterModal(){
  document.getElementById("semesterModal").style.display="none";
}

function saveSemesterEvent(){
  const cats=[...document.querySelectorAll('#semesterModal input[type="checkbox"]:checked')]
    .map(c=>c.value);

  if(!cats.length){
    alert("Selecciona al menos una categor√≠a");
    return;
  }

  const start=semStart.value;
  const end=semEnd.value;
  const detail=semDetail.value;

  if(!start||!end){
    alert("Fechas obligatorias");
    return;
  }

  cats.forEach(cat=>{
    events.push({
      start,
      end,
      detail,
      class:"cat-"+cat
    });
  });

  saveEvents();
  closeSemesterModal();
  renderSemester();
}

/* ================== BORRAR GEN√âRICO ================== */
function deleteEvent(idx){
  if(confirm("Eliminar evento?")){
    events.splice(idx,1);
    saveEvents();
    renderWeek();
    renderMonth();
    renderSemester();
  }
}

/* ================== INIT ================== */
renderDay();
renderWeek();
renderMonth();
renderSemester();
</script>

</body>
</html>

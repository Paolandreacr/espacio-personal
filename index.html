<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi Espacio Terap√©utico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --beige:#f7f3ee;
  --lila:#c6b7e2;
  --menta:#bfe6d3;
  --menta-fuerte:#9fd9c1;
  --salmon:#f4b6a8;
  --azul:#b7d8f4;
  --ocre:#f1d18a;
  --texto:#4a4a4a;
}

/* ================== BASE ================== */
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--beige);
  color:var(--texto);
}

header{
  padding:16px;
  background:linear-gradient(90deg,var(--menta),var(--lila));
  font-weight:600;
}

.tabs{
  display:flex;
  gap:6px;
  padding:10px;
  background:#fff;
  overflow-x:auto;
}

.tab{
  border:none;
  background:var(--menta);
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}

.tab.active{
  background:var(--menta-fuerte);
  font-weight:600;
}

.content{
  display:none;
  padding:16px;
}

.content.active{
  display:block;
}

/* ================== D√çA ================== */
.day-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.date-nav button{
  border:none;
  background:none;
  font-size:20px;
  cursor:pointer;
}

.intention{
  margin:12px 0;
  font-style:italic;
  color:#9a8bc7;
}

.hour-block{
  background:#fff;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
  border-left:6px solid var(--menta);
}

.half-hour{
  display:flex;
  gap:6px;
  align-items:center;
  margin-top:6px;
}

.half-hour input[type="text"]{
  flex:1;
  border:1px solid #ddd;
  border-radius:8px;
  padding:6px;
}

/* ================== SEMANA ================== */
.week-nav{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-bottom:10px;
}

.week-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}

.week-day{
  background:#fff;
  border-radius:12px;
  padding:8px;
  min-height:160px;
  border-top:6px solid var(--menta);
}

.week-day h4{
  margin:0 0 6px;
  font-size:13px;
}

.week-event{
  font-size:12px;
  background:#eef8f3;
  border-radius:6px;
  padding:4px;
  margin-bottom:4px;
  display:flex;
  justify-content:space-between;
  gap:6px;
}

.week-event button{
  border:none;
  background:none;
  cursor:pointer;
}

/* ================== MES ================== */
.month-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}

.month-day{
  background:#fff;
  border-radius:10px;
  padding:6px;
  min-height:90px;
  border-top:4px solid var(--menta);
  font-size:12px;
}

.month-event{
  margin-top:4px;
  border-radius:6px;
  padding:2px 4px;
  font-size:11px;
  display:flex;
  justify-content:space-between;
}

.month-cumple{background:var(--salmon);}
.month-vet{background:var(--menta);}
.month-medico{background:var(--azul);}

/* ================== SEMESTRE ================== */
.semester{
  display:grid;
  grid-template-columns:1fr;
  gap:20px;
}

.semester-month{
  background:#fff;
  border-radius:16px;
  padding:10px;
}

.semester-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  font-size:11px;
}

.semester-day{
  border-radius:6px;
  padding:4px;
  background:#f5f5f5;
  display:flex;
  flex-direction:column;
  gap:2px;
}

.roadbar{
  width:100%;
  height:6px;
  border-radius:4px;
  opacity:.85;
  cursor:pointer;
}

/* ================== PROYECTOS ================== */
.projects-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.add-project-btn{
  border:none;
  background:var(--menta);
  width:36px;
  height:36px;
  border-radius:50%;
  font-size:20px;
  cursor:pointer;
}

.projects-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:14px;
}

.project-folder{
  border-radius:14px;
  padding:20px 10px;
  text-align:center;
  cursor:pointer;
  position:relative;
  font-weight:600;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

.project-actions{
  position:absolute;
  top:6px;
  right:6px;
  display:flex;
  gap:6px;
}

.project-actions button{
  border:none;
  background:rgba(255,255,255,.7);
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

/* colores carpetas */
.folder-rosado{background:#f7c6d9;}
.folder-salmon{background:var(--salmon);}
.folder-lila{background:var(--lila);}
.folder-violeta{background:#b49ddb;}
.folder-menta{background:var(--menta);}
.folder-aguamarina{background:#a8e6e1;}
.folder-azul{background:var(--azul);}
.folder-ocre{background:var(--ocre);}
.folder-beige{background:var(--beige);}

/* ================== SUBVISTA PROYECTO ================== */
.project-view{display:none;}
.project-view.active{display:block;}

.project-view-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-radius:14px;
  margin-bottom:14px;
}

.close-project{
  border:none;
  background:none;
  font-size:18px;
  cursor:pointer;
}

/* ================== PENDIENTES ================== */
.task-input{
  width:100%;
  border:none;
  border-bottom:1px solid #ccc;
  padding:6px;
  font-size:14px;
  margin-bottom:10px;
}

.task-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:6px;
}

.task-row input[type="text"]{
  border:none;
  background:transparent;
  flex:1;
}

.task-row.done input[type="text"]{
  text-decoration:line-through;
  opacity:.6;
}

.task-row button{
  border:none;
  background:none;
  cursor:pointer;
  font-size:12px;
}

/* ================== SECCIONES ================== */
.project-section{
  background:#fff;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}

/* ================== MODALES ================== */
#monthModal,
#semesterModal,
#projectModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.modal-box{
  background:#fff;
  padding:16px;
  border-radius:14px;
  width:260px;
}

/* ================== BURBUJA SEMESTRE ================== */
#semesterInfo{
  position:fixed;
  background:#fff;
  border:1px solid #ccc;
  padding:10px;
  border-radius:10px;
  display:none;
  z-index:9999;
}
/* ===== KIT DE MARCA ===== */
.brand-item{
  border:1px solid #eee;
  border-radius:10px;
  margin-bottom:10px;
  overflow:hidden;
}

.brand-header{
  background:#f7f3ee;
  padding:8px 10px;
  font-size:13px;
  font-weight:600;
  display:flex;
  justify-content:space-between;
  cursor:pointer;
}

.brand-item textarea{
  width:100%;
  min-height:80px;
  border:none;
  padding:8px;
  display:none;
  font-size:13px;
}

.brand-item.open textarea{
  display:block;
}
/* ===== DOCUMENTOS PROYECTO ===== */
.file-upload{
  border:2px dashed #ccc;
  border-radius:12px;
  padding:16px;
  text-align:center;
  cursor:pointer;
  margin-bottom:10px;
  font-size:13px;
}

.file-upload label{
  cursor:pointer;
}

.file-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:13px;
  margin-bottom:6px;
}

.file-row a{
  color:#4a4a4a;
  text-decoration:none;
}

.file-row button{
  border:none;
  background:none;
  cursor:pointer;
}
</style>
</head>
<body>

<header>üå± Mi espacio</header>

<div class="tabs">
  <button class="tab active" onclick="openTab('day')">D√≠a</button>
  <button class="tab" onclick="openTab('week')">Semana</button>
  <button class="tab" onclick="openTab('month')">Mes</button>
  <button class="tab" onclick="openTab('semester')">Semestre</button>
  <button class="tab" onclick="openTab('projects')">Proyectos</button>
  <button class="tab" onclick="openTab('health')">Salud</button>
</div>

<!-- ================== D√çA ================== -->
<div id="day" class="content active">
  <div class="day-header">
    <div class="date-nav">
      <button onclick="changeDay(-1)">‚Üê</button>
      <span id="currentDate"></span>
      <button onclick="changeDay(1)">‚Üí</button>
    </div>
  </div>

  <div class="intention">
    Intenci√≥n del d√≠a
    <input type="text" id="dayIntention" style="width:100%;margin-top:6px">
  </div>

  <div id="hours"></div>
</div>

<!-- ================== SEMANA ================== -->
<div id="week" class="content">
  <div class="week-nav">
    <button onclick="changeWeek(-1)">‚Üë</button>
    <strong>Semana</strong>
    <button onclick="changeWeek(1)">‚Üì</button>
  </div>
  <div class="week-grid" id="weekGrid"></div>
</div>

<!-- ================== MES ================== -->
<div id="month" class="content">
  <div id="monthGrid" class="month-grid"></div>
</div>

<!-- ================== MODAL MES ================== -->
<div id="monthModal">
  <div class="modal-box">
    <h4>Nuevo evento</h4>

    <label>Categor√≠a</label>
    <select id="monthCategory" onchange="handleMonthCategory()">
      <option value="">Selecciona</option>
      <option value="cumple">Cumplea√±os</option>
      <option value="vet">Vet</option>
      <option value="medico">M√©dico</option>
    </select>

    <input id="monthDetail" type="text" placeholder="Detalle">
    <input id="monthHour" type="time" style="display:none;">

    <button onclick="saveMonthEvent()">Guardar</button>
    <button onclick="closeMonthModal()">Cancelar</button>
  </div>
</div>

<!-- ================== SEMESTRE ================== -->
<div id="semester" class="content">
  <div id="semesterView" class="semester"></div>

  <div id="semesterInfo">
    <div id="semesterInfoContent"></div>
    <button onclick="editSemesterEvent()">‚úèÔ∏è Editar</button>
    <button onclick="deleteSemesterEvent()">üóë Eliminar</button>
  </div>
</div>

<!-- ================== MODAL SEMESTRE ================== -->
<div id="semesterModal">
  <div class="modal-box">
    <h4>Nuevo proyecto</h4>

    <label><input type="checkbox" value="DesdeCeroLatam"> DesdeCeroLatam</label><br>
    <label><input type="checkbox" value="RelazoApp"> RelazoApp</label><br>
    <label><input type="checkbox" value="ComoSucedio"> ComoSucedio</label><br>
    <label><input type="checkbox" value="SegundoLibro"> SegundoLibro</label><br>
    <label><input type="checkbox" value="VidaEnEuropa"> VidaEnEuropa</label><br><br>

    <input id="semStart" type="date"><br><br>
    <input id="semEnd" type="date"><br><br>
    <input id="semDetail" type="text" placeholder="Detalle"><br><br>

    <button onclick="saveSemesterEvent()">Guardar</button>
    <button onclick="closeSemesterModal()">Cancelar</button>
  </div>
</div>
<!-- ================== PROYECTOS ================== -->
<div id="projects" class="content">

  <!-- Vista principal -->
  <div id="projectsMain">
    <div class="projects-header">
      <h3>Proyectos</h3>
      <button class="add-project-btn" onclick="openProjectModal()">Ôºã</button>
    </div>

    <div class="projects-grid" id="projectsGrid"></div>
  </div>

  <!-- Subvista proyecto -->
  <div id="projectView" class="project-view">

    <div class="project-view-header" id="projectViewHeader">
      <strong id="projectTitle"></strong>
      <button class="close-project" onclick="closeProjectView()">‚úñ</button>
    </div>

    <!-- Pendientes -->
    <div class="project-section">
      <h4>‚úÖ Pendientes</h4>

      <input
        type="text"
        class="task-input"
        id="taskInput"
        placeholder="Escribe y presiona Enter">

      <div id="projectTasks"></div>
    </div>

    <!-- Documentos -->
    <div class="project-section">
      <h4>üìÇ Documentos importantes</h4>
      <p style="font-size:12px;color:#777">
        Pr√≥ximamente podr√°s subir archivos (pdf, doc, jpg, etc.)
      </p>
  <input
  type="file"
  onchange="uploadProjectFile(this.files[0])"
/>

<div id="projectDocuments"></div>
    <div class="file-upload">
 <input
  type="file"
  id="fileInput"
  multiple
  onchange="uploadProjectFile(this.files[0])"
>
  <label for="fileInput">
    üìé Haz clic para subir archivos
  </label>
</div>

<div id="fileList"></div>
    </div>

<!-- Kit de marca -->
<div class="project-section">
  <h4>üé® Kit de marca</h4>

  <div class="brand-item" data-key="colors">
    <div class="brand-header" onclick="toggleBrand(this)">
      üé® Colores de marca
      <button onclick="deleteBrand(event,'colors')">üóë</button>
    </div>
    <textarea
      placeholder="Paleta, c√≥digos HEX, usos..."
      oninput="saveBrand('colors', this.value)"></textarea>
  </div>

  <div class="brand-item" data-key="fonts">
    <div class="brand-header" onclick="toggleBrand(this)">
      üî§ Tipograf√≠as
      <button onclick="deleteBrand(event,'fonts')">üóë</button>
    </div>
    <textarea
      placeholder="Nombre de fuentes, usos, enlaces..."
      oninput="saveBrand('fonts', this.value)"></textarea>
  </div>

  <div class="brand-item" data-key="logo">
    <div class="brand-header" onclick="toggleBrand(this)">
      üñº Logo
      <button onclick="deleteBrand(event,'logo')">üóë</button>
    </div>
    <textarea
      placeholder="Versiones, notas, links..."
      oninput="saveBrand('logo', this.value)"></textarea>
  </div>

  <div class="brand-item" data-key="images">
    <div class="brand-header" onclick="toggleBrand(this)">
      üì∑ Im√°genes
      <button onclick="deleteBrand(event,'images')">üóë</button>
    </div>
    <textarea
      placeholder="Banco visual, referencias..."
      oninput="saveBrand('images', this.value)"></textarea>
  </div>

  <div class="brand-item" data-key="topics">
    <div class="brand-header" onclick="toggleBrand(this)">
      üß† Banco de temas
      <button onclick="deleteBrand(event,'topics')">üóë</button>
    </div>
    <textarea
      placeholder="Ideas, l√≠neas editoriales..."
      oninput="saveBrand('topics', this.value)"></textarea>
  </div>

</div>


  </div>
</div>

<!-- ================== MODAL NUEVO / EDITAR PROYECTO ================== -->
<div id="projectModal">
  <div class="modal-box">
    <h4 id="projectModalTitle">Nuevo proyecto</h4>

    <input id="projectName" type="text" placeholder="Nombre del proyecto">

    <label>Color</label>
    <select id="projectColor">
      <option value="rosado">Rosado</option>
      <option value="salmon">Salm√≥n</option>
      <option value="lila">Lila</option>
      <option value="violeta">Violeta</option>
      <option value="menta">Menta</option>
      <option value="aguamarina">Aguamarina</option>
      <option value="azul">Azul</option>
      <option value="ocre">Ocre</option>
      <option value="beige">Beige</option>
    </select>

    <div style="margin-top:12px;text-align:right">
      <button onclick="saveProject()">Guardar</button>
      <button onclick="closeProjectModal()">Cancelar</button>
    </div>
  </div>
</div>

<!-- ================== SALUD ================== -->
<div id="health" class="content">üíö Salud (en desarrollo)</div>
  
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAJwzhsLDjamvPmPYoWbvnmbZpfKJylv8Y",
    authDomain: "mi-espacio-terapeutico.firebaseapp.com",
    projectId: "mi-espacio-terapeutico",
    storageBucket: "mi-espacio-terapeutico.firebasestorage.app",
    messagingSenderId: "530552474926",
    appId: "1:530552474926:web:2e27adb503fcf0c6187ebf"
  };

  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);

  window.uploadProjectFile = async function(file){
    if(!window.activeProject || !file) return;

    const fileRef = ref(
      storage,
      `projects/${activeProject.id}/${file.name}`
    );

    await uploadBytes(fileRef, file);
    const url = await getDownloadURL(fileRef);

    if(!activeProject.documents) activeProject.documents = [];
    activeProject.documents.push({ name:file.name, url });

    localStorage.setItem("projects", JSON.stringify(projects));
    renderProjectDocuments();
  };
</script>
  
  <script>
/* ================== ESTADO GLOBAL ================== */
let currentDay = new Date();
let currentWeekOffset = 0;
let currentMonth = new Date();
let semesterStart = new Date(currentMonth.getFullYear(), 0, 1);

let events = JSON.parse(localStorage.getItem("events") || "[]");
let projects = JSON.parse(localStorage.getItem("projects") || "[]");

let selectedMonthDate = null;
let selectedSemesterEvent = null;
let activeProject = null;
let editingProjectId = null;

/* ================== UTILIDADES ================== */
function saveEvents(){
  localStorage.setItem("events", JSON.stringify(events));
}

function saveProjects(){
  localStorage.setItem("projects", JSON.stringify(projects));
}

function formatDate(d){
  return d.toISOString().split("T")[0];
}

function openTab(id){
  document.querySelectorAll(".content").forEach(c=>c.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

/* ================== D√çA ================== */
function renderDay(){
  currentDate.textContent =
    currentDay.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"});

  hours.innerHTML="";
  for(let h=6;h<=22;h++){
    const block=document.createElement("div");
    block.className="hour-block";
    block.innerHTML=`
      <strong>${h}:00</strong>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":00">
      </div>
      <div class="half-hour">
        <input type="checkbox">
        <input type="text" placeholder=":30">
      </div>
    `;
    hours.appendChild(block);
  }
}

function changeDay(delta){
  currentDay.setDate(currentDay.getDate()+delta);
  renderDay();
}

/* ================== SEMANA ================== */
function renderWeek(){
  weekGrid.innerHTML="";
  const base=new Date();
  base.setDate(base.getDate()-base.getDay()+1+(currentWeekOffset*7));

  for(let i=0;i<7;i++){
    const d=new Date(base);
    d.setDate(base.getDate()+i);

    const dayDiv=document.createElement("div");
    dayDiv.className="week-day";
    dayDiv.innerHTML=`<h4>${d.toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})}</h4>`;

    events.filter(e=>e.date===formatDate(d) && e.showWeek)
      .forEach((e,idx)=>{
        const ev=document.createElement("div");
        ev.className="week-event";
        ev.innerHTML=`${e.text||""} ${e.hour||""}
          <button onclick="deleteEvent(${idx})">üóë</button>`;
        dayDiv.appendChild(ev);
      });

    weekGrid.appendChild(dayDiv);
  }
}

function changeWeek(delta){
  currentWeekOffset+=delta;
  renderWeek();
}

/* ================== MES ================== */
function renderMonth(){
  monthGrid.innerHTML="";
  const y=currentMonth.getFullYear();
  const m=currentMonth.getMonth();
  const first=new Date(y,m,1);
  const start=(first.getDay()+6)%7;
  const days=new Date(y,m+1,0).getDate();

  for(let i=0;i<start;i++) monthGrid.appendChild(document.createElement("div"));

  for(let d=1;d<=days;d++){
    const date=new Date(y,m,d);
    const cell=document.createElement("div");
    cell.className="month-day";
    cell.innerHTML=`<strong>${d}</strong>`;
    cell.onclick=()=>openMonthModal(date);

    events.filter(e=>e.date===formatDate(date)).forEach((e,idx)=>{
      const ev=document.createElement("div");
      ev.className="month-event "+(e.class||"");
      ev.innerHTML=`${e.text||""}${e.hour?" ‚è∞"+e.hour:""}
        <span onclick="deleteEvent(${idx})">üóë</span>`;
      cell.appendChild(ev);
    });

    monthGrid.appendChild(cell);
  }
}

/* ================== MODAL MES ================== */
function openMonthModal(date){
  selectedMonthDate=date;
  monthCategory.value="";
  monthDetail.value="";
  monthHour.value="";
  monthHour.style.display="none";
  monthModal.style.display="flex";
}

function closeMonthModal(){
  monthModal.style.display="none";
}

function handleMonthCategory(){
  monthHour.style.display =
    (monthCategory.value==="vet"||monthCategory.value==="medico")?"block":"none";
}

function saveMonthEvent(){
  const cat=monthCategory.value;
  const detail=monthDetail.value;
  const hour=monthHour.value;
  if(!cat||!detail) return alert("Completa los campos");

  let text="", cls="";
  if(cat==="cumple"){text="üéÇ "+detail;cls="month-cumple";}
  if(cat==="vet"){text="üê∂ Vet: "+detail;cls="month-vet";}
  if(cat==="medico"){text="ü©∫ M√©dico: "+detail;cls="month-medico";}

  events.push({date:formatDate(selectedMonthDate),text,hour,class:cls});
  saveEvents();
  closeMonthModal();
  renderMonth();
  renderWeek();
}

/* ================== SEMESTRE ================== */
function renderSemester(){
  semesterView.innerHTML="";
  for(let m=0;m<6;m++){
    const month=new Date(semesterStart.getFullYear(),semesterStart.getMonth()+m,1);
    const box=document.createElement("div");
    box.className="semester-month";
    box.innerHTML=`<h4>${month.toLocaleDateString("es-ES",{month:"long"})}</h4>`;

    const grid=document.createElement("div");
    grid.className="semester-grid";
    const days=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();

    for(let d=1;d<=days;d++){
      const cell=document.createElement("div");
      cell.className="semester-day";
      cell.textContent=d;

      events.filter(e=>e.start&&e.end &&
        new Date(e.start)<=new Date(month.getFullYear(),month.getMonth(),d) &&
        new Date(e.end)>=new Date(month.getFullYear(),month.getMonth(),d)
      ).forEach(e=>{
        const bar=document.createElement("div");
        bar.className="roadbar "+e.class;
        cell.appendChild(bar);
      });

      cell.onclick=()=>semesterModal.style.display="flex";
      grid.appendChild(cell);
    }

    box.appendChild(grid);
    semesterView.appendChild(box);
  }
}

function closeSemesterModal(){
  semesterModal.style.display="none";
}

function saveSemesterEvent(){
  const cats=[...semesterModal.querySelectorAll("input:checked")].map(c=>c.value);
  if(!cats.length) return;

  cats.forEach(cat=>{
    events.push({
      start:semStart.value,
      end:semEnd.value,
      detail:semDetail.value,
      class:"cat-"+cat
    });
  });

  saveEvents();
  closeSemesterModal();
  renderSemester();
}

/* ================== PROYECTOS ================== */
function openProjectModal(project=null){
  projectModal.style.display="flex";
  if(project){
    projectModalTitle.textContent="Editar proyecto";
    projectName.value=project.name;
    projectColor.value=project.color;
    editingProjectId=project.id;
  }else{
    projectModalTitle.textContent="Nuevo proyecto";
    projectName.value="";
    projectColor.value="rosado";
    editingProjectId=null;
  }
}

function closeProjectModal(){
  projectModal.style.display="none";
}

function saveProject(){
  const name=projectName.value.trim();
  const color=projectColor.value;
  if(!name) return alert("Ponle nombre");

  if(editingProjectId){
    const p=projects.find(p=>p.id===editingProjectId);
    p.name=name;
    p.color=color;
    editingProjectId=null;
  }else{
    projects.push({
      id:Date.now(),
      name,
      color,
      tasks:[],
      documents:[],
      brandKit:{}
    });
  }

  saveProjects();
  closeProjectModal();
  renderProjects();
}

function deleteProject(id){
  if(!confirm("¬øEliminar proyecto?")) return;
  projects=projects.filter(p=>p.id!==id);
  saveProjects();
  renderProjects();
}

function renderProjects(){
  projectsGrid.innerHTML="";
  projects.forEach(p=>{
    const div=document.createElement("div");
    div.className=`project-folder folder-${p.color}`;
    div.innerHTML=`
      <div class="project-actions">
        <button onclick="event.stopPropagation();openProjectModal(${JSON.stringify(p).replace(/"/g,'&quot;')})">‚úèÔ∏è</button>
        <button onclick="event.stopPropagation();deleteProject(${p.id})">üóë</button>
      </div>
      <div>${p.name}</div>
    `;
    div.onclick=()=>openProject(p.id);
    projectsGrid.appendChild(div);
  });
}

function openProject(id){
  activeProject=projects.find(p=>p.id===id);
  projectsMain.style.display="none";
  projectView.classList.add("active");
  projectTitle.textContent=activeProject.name;
  projectViewHeader.className=`project-view-header folder-${activeProject.color}`;
  renderProjectTasks();
  renderProjectDocuments(); 
}

function closeProjectView(){
  projectView.classList.remove("active");
  projectsMain.style.display="block";
  activeProject=null;
}

/* ================== PENDIENTES ================== */
function renderProjectTasks(){
  projectTasks.innerHTML="";
  activeProject.tasks.forEach((t,idx)=>{
    const row=document.createElement("div");
    row.className="task-row"+(t.done?" done":"");
    row.innerHTML=`
      <input type="checkbox" ${t.done?"checked":""}
        onchange="toggleTask(${idx})">
      <input type="text" value="${t.text}"
        onchange="editTask(${idx},this.value)">
      <button onclick="deleteTask(${idx})">üóë</button>
    `;
    projectTasks.appendChild(row);
  });
}

document.addEventListener("keydown",e=>{
  if(!activeProject || e.target.id!=="taskInput") return;
  if(e.key==="Enter" && e.target.value.trim()){
    activeProject.tasks.push({text:e.target.value.trim(),done:false});
    e.target.value="";
    saveProjects();
    renderProjectTasks();
  }
});

function toggleTask(idx){
  activeProject.tasks[idx].done=!activeProject.tasks[idx].done;
  saveProjects();
  renderProjectTasks();
}

function editTask(idx,value){
  activeProject.tasks[idx].text=value;
  saveProjects();
}

function deleteTask(idx){
  activeProject.tasks.splice(idx,1);
  saveProjects();
  renderProjectTasks();
}

/* ================== BORRAR ================== */
function deleteEvent(idx){
  if(confirm("Eliminar evento?")){
    events.splice(idx,1);
    saveEvents();
    renderWeek();
    renderMonth();
    renderSemester();
  }
}

/* ================== INIT ================== */
renderDay();
renderWeek();
renderMonth();
renderSemester();
renderProjects();
/* ================== KIT DE MARCA ================== */

function toggleBrand(header){
  const box = header.parentElement;
  box.classList.toggle("open");
}

function saveBrand(key, value){
  if(!activeProject) return;
  if(!activeProject.brandKit) activeProject.brandKit = {};
  activeProject.brandKit[key] = value;
  saveProjects();
}

function deleteBrand(event, key){
  event.stopPropagation();
  if(!activeProject || !activeProject.brandKit) return;
  if(!confirm("¬øEliminar esta informaci√≥n?")) return;
  delete activeProject.brandKit[key];
  saveProjects();
  renderProjectTasks();
}

function loadBrandKit(){
  if(!activeProject || !activeProject.brandKit) return;
  document.querySelectorAll(".brand-item").forEach(item=>{
    const key = item.dataset.key;
    const textarea = item.querySelector("textarea");
    textarea.value = activeProject.brandKit[key] || "";
  });
}

/* cargar kit al abrir proyecto */
const originalOpenProject = openProject;
openProject = function(id){
  originalOpenProject(id);
  setTimeout(loadBrandKit, 0);
};
function renderProjectDocuments(){
  const container = document.getElementById("projectDocuments");
  if (!container || !activeProject) return;

  container.innerHTML = "";

  (activeProject.documents || []).forEach(doc=>{
    const div = document.createElement("div");
    div.style.fontSize = "13px";
    div.innerHTML = `
      üìÑ <a href="${doc.url}" target="_blank">${doc.name}</a>
    `;
    container.appendChild(div);
  });
}
</script>

</body>
</html>
